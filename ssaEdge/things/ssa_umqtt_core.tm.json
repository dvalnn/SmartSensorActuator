{
    "@context": [
        "https://www.w3.org/2022/wot/td/v1.1",
        "https://raw.githubusercontent.com/w3c/wot-binding-templates/refs/heads/main/bindings/protocols/mqtt/context.jsonld"
    ],
    "@type": "tm:ThingModel",
    "title": "ssa_umqtt_core",
    "version": {
        "model": "0.1.0"
    },

    "description": "Models the core functionality of the SSA uMQTT runtime, an ssa runtime implemented using micropython that uses MQTT as the underlying communication protocol.",

    "links" : [{
        "rel": "tm:extends",
        "href": "http://127.0.0.1:8080/models/ssa_core.tm",
        "type": "application/tm+json"
    }],

    "forms": [
        {
            "href": "mqtt://{{MQTT_BROKER_ADDR}}",
            "mqv:filter": "ssa/{{THING_UUID_V4}}/properties/#",
            "op": [
                "readallproperties",
                "observeallproperties",
                "unobserveallproperties"
            ],
            "mqv:qos": 1,
            "contentType": "application/vnd.msgpack"
        },
        {
            "href": "mqtt://{{MQTT_BROKER_ADDR}}",
            "mqv:filter": "ssa/{{THING_UUID_V4}}/events/#",
            "op": [
                "subscribeallevents",
                "unsubscribeallevents"
            ],
            "mqv:qos": 1,
            "contentType": "application/vnd.msgpack"
        }
    ],

    "properties": {
        "coreStatus": {
            "observable": true,
            "forms": [{
                "href": "mqtt://{{MQTT_BROKER_ADDR}}",
                "mqv:topic": "ssa/{{THING_UUID_V4}}/properties/umqtt_core/status",
                "op": [
                    "readproperty",
                    "observeproperty",
                    "unobserveproperty"
                ],
                "mqv:qos": 1,
                "mqv:retain": true,
                "contentType": "application/vnd.msgpack"
            }]
        },

        "coreVFSActionResponse": {
            "title": "Core VFS Action Response",
            "description": "Response for the last Virtual File System action.",

            "observable": true,
            "readOnly": true,
            "writeOnly": false,

            "type": "object",
            "properties": {
                "action": {
                    "type": "string",
                    "title": "Last Action Performed",
                    "description": "The last action performed on the Virtual File System.",
                    "enum": [
                        "write",
                        "delete"
                    ]
                },
                "result": {
                    "type": "string",
                    "title": "Result",
                    "description": "Result of the last action performed on the Virtual File System.",
                    "enum": [
                        "success",
                        "error"
                    ]
                },
                "message": {
                    "type": "string",
                    "title": "Message",
                    "description": "Message associated with the last action performed on the Virtual File System."
                },
                "timestamp": {
                    "type": "string",
                    "title": "Timestamp",
                    "description": "Timestamp of the last action performed on the Virtual File System."
                }
            },

            "required": ["action", "result", "timestamp"],

            "forms": [{
                "href": "mqtt://{{MQTT_BROKER_ADDR}}",
                "mqv:topic": "ssa/{{THING_UUID_V4}}/properties/umqtt_core/vfs/report",
                "op": [
                    "readproperty",
                    "observeproperty",
                    "unobserveproperty"
                ],
                "mqv:qos": 1,
                "mqv:retain": true,
                "contentType": "application/vnd.msgpack"
            }]
        }
    },

    "actions": {
        "ssaVFSAction": {
            "input": {
                "properties":{
                    "contents": {
                        "properties":{
                            "algo": {
                                "const": "crc32"
                            }
                        }
                    }
                }
            }
            "forms": [{
                "href": "mqtt://{{MQTT_BROKER_ADDR}}",
                "mqv:topic": "ssa/{{THING_UUID_V4}}/actions/umqtt_core/vfs",
                "op": [
                    "invokeaction"
                ],
                "mqv:qos": 1,
                "mqv:retain": false,
                "contentType": "application/vnd.msgpack"
            }]
        },

        "ssaCoreReload": {
            "forms": [{
                "href": "mqtt://{{MQTT_BROKER_ADDR}}",
                "mqv:topic": "ssa/{{THING_UUID_V4}}/actions/umqtt_core/reload",
                "op": [
                    "invokeaction"
                ],
                "mqv:qos": 1,
                "mqv:retain": false
            }]
        }
    }
}
